FROM <%= from %>
USER root
RUN useradd -m -U -d <%= CIDE_DIR %> cide

# Install system build dependencies here

<% as_root.each do |cmd| -%>
RUN <%= cmd %>
<% end -%>

# Before

<% if before['run'] -%>
  <% before['add'].to_a.each do |file| -%>
ADD <%= file %> <%= File.expand_path(file, CIDE_SRC_DIR) %>
  <% end %>
RUN chown -R cide:cide <%= CIDE_SRC_DIR %>
RUN su -l cide -c "cd <%= CIDE_SRC_DIR %> && <%= Shellwords.escape(before['run'].to_s) %>"
<% end -%>

# Add project data

ADD . <%= CIDE_SRC_DIR %>
RUN chown -R cide:cide <%= CIDE_SRC_DIR %>

# Test !

RUN su -l cide -c "cd <%= CIDE_SRC_DIR %> && <%= Shellwords.escape(command.to_s) %>"
